{% extends "sampleApp/base.html" %}
{% load static %}
{% block head %}
    <style>
        .hidden {
            display: none;
        }
    </style>
    <script type="text/javascript">
        function delete_attachment(id) {
            let btn = document.getElementById('attachment-delete-'+id)
            btn.classList.add("hidden")
            btn = document.getElementById('attachment-delete-link-'+id)
            btn.classList.remove("hidden")
            btn = document.getElementById('attachment-delete-cancel-'+id)
            btn.classList.remove("hidden")
        }

        function cancel(id) {
            let btn = document.getElementById('attachment-delete-'+id)
            btn.classList.remove("hidden")
            btn = document.getElementById('attachment-delete-link-'+id)
            btn.classList.add("hidden")
            btn = document.getElementById('attachment-delete-cancel-'+id)
            btn.classList.add("hidden")
        }
    </script>
{% endblock %}
{% block content %}
    <h1>Create post</h1>
    <div>
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            {{ form.as_div }}
            {{ post_attachment_form.as_div }}
            <input type="submit" value="Create">
        </form>

        <div>
            {% if attachments %}
                currently uploaded attachments:

                {% for attachment in attachments %}
                    <div>
                        <a href="{{ attachment.attachment.url }}" target="_blank">{{ attachment.filename }}</a>

                        <button id="attachment-delete-{{ attachment.id }}" class="" onclick="delete_attachment({{ attachment.id }})">x</button>

                        <a class="attachment-delete hidden" id="attachment-delete-link-{{ attachment.id }}"
                           href="{% url 'attachment-delete' post.id attachment.id %}">Yes, delete</a>

                        <button class="attachment-delete hidden" id="attachment-delete-cancel-{{ attachment.id }}"
                                onclick="cancel({{ attachment.id }})">
                            Cancel
                        </button>

                    </div>
                {% endfor %}
            {% endif %}
        </div>

        <div class="errors">
            {% for field, error in form.errors.items %}
                <div class="error_element">
                    {{ error|striptags }}
                </div>
            {% endfor %}
        </div>
    </div>


{% endblock content %}